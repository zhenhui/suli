define("sjplus/design-works/0.0.1/tag/tag",["/go/design-works/tag?callback=define","./tag.tpl","template"],function(a){KISSY.use("dom,event,json,io",function(b,c,d){function e(){l&&4!=l.readyState&&l.abort();var a=f();m.addClass("loading btn-disabled").html("&nbsp;"),l=$.ajax({url:"/design-works/filter/json",dataType:"jsonp",data:{tag:a.tag,category:a.category,page:p,pageNum:q,count:r}}).done(function(a){s=a.sumPage,m.removeClass("loading"),p===a.sumPage||0===a.sumPage?m.html("没有更多了").addClass("btn-disabled"):m.html("加载更多").removeClass("btn-disabled"),$(o.render(n,a)).appendTo(t),t.removeClass("loading")})}function f(){var a=[];j.find("a.active").each(function(b,c){a.push($(c).find(".J-tag").text())});var b=[];k.find("a.active").each(function(a,c){b.push($(c).find(".J-text").text())});var c={tag:a.join(","),category:b.join(",")};return c.tag.length<1&&delete c.tag,c.category.length<1&&delete c.category,window.location.hash=c.tag||c.category?"#"+JSON.stringify(c):"",c}function g(){if(location.hash.length>8)try{var a=JSON.parse(location.hash.substring(1))}catch(c){console.log("没有发现配置")}a&&(a.tag&&b.each(a.tag.split(","),function(a){j.find('[data-text="'+a+'"]').addClass("active")}),a.category&&b.each(a.category.split(","),function(a){k.find('[data-text="'+a+'"]').addClass("active")}))}function h(){c.scrollTop()>v.offset().top?u.addClass("fixed"):u.removeClass("fixed")}var i=b.map(a("/go/design-works/tag?callback=define").replace(/\s/gm,"").split(/[,，]/gim),function(a){return'<a href="#" data-text="'+a+'" class="tag"><span class="J-tag">'+a+'</span><span class="close J-close">&times;</span></a> '}),j=$("#J-tag-control-container"),k=$("#J-category-container");j.html(i.join("")),a.async("/design-works/json/category?callback=define",function(a){var c=b.map(b.keys(a),function(b){return'<a href="#" data-text="'+b+'" class="tag J-category"><span class="J-text">'+b+'</span>(<span class="J-count">'+a[b]+'</span>)<span class="close J-close">&times;</span></a>'});k.html(c)});var l,m=$(".J-show-more"),n=a("./tag.tpl"),o=a("template"),p=1,q=1,r=36,s=0,t=$("#J-design-works-list");m.on("click",function(a){a.preventDefault(),$(this).hasClass("loading")||(s>p?(p++,e()):$(this).html("没有更多了").addClass("btn-disabled"))}),j.on("click","a.tag",function(a){a.preventDefault();var b=$(a.currentTarget);b.toggleClass("active"),t.addClass("loading").html(""),f()}),k.on("click",".J-category",function(a){a.preventDefault();var b=$(a.currentTarget);b.toggleClass("active").siblings(".J-category").removeClass("active"),t.addClass("loading").html(""),f()}),g(),d.on(window,"hashchange",e),d.fire(window,"hashchange",e);var u=$("#sidebar-wrapper"),v=$("#tag-design-works-wrapper");d.on(window,"scroll",h),d.fire(window,"scroll",h)})}),define("sjplus/design-works/0.0.1/tag/tag.tpl",[],'#each(item in data)\n<li>\n    <div class="describe"><h2>#{item.title}</h2><p>#{item.content}</p></div>\n    <img src="#{imgCDN}/read/#{item.thumbnails_id}" class="thumbnails">\n    <a href="#{hostDOMAIN}/design-works/detail/#{item._id}" target="_blank" class="link"></a>\n    <div class="avatar">\n        <a href="/u/#{item.owner_id}"><img src="#{imgCDN}/avatar/#{item.owner_id}_20x20"></a>\n    </div>\n    <div class="info">\n        <span class="view"> <b class="data-icon" data-icon="&#xe00a;"></b> #{item.index.view} </span>\n        <span class="like"> <b class="data-icon" data-icon="&#xe007;"></b> #{item.index.like} </span>\n        <span class="comment"> <b class="data-icon" data-icon="&#xe015;"></b> #{item.index.comment} </span>\n    </div>\n</li>\n#end');
