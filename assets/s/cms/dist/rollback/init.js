define("sjplus/cms/stable/rollback/init",["template","./rollback-source.tpl"],function(a){var b=a("template");KISSY.use("overlay,event,dom",function(c,d,e){function f(){i.show(),i.center()}function g(){i.get("visible")&&i.center()}var h=a("./rollback-source.tpl"),i=new d.Dialog({elCls:"J-rollback-source",elStyle:{position:6==c.UA.ie?"absolute":"fixed"},zIndex:999,bodyContent:"",mask:!0,align:{points:["cc","cc"]}});e.on(window,"scroll resize",g),$(document).on("click",".J-rollback",function(a){$.ajax("/cms/rollback/history",{data:{page_id:$(a.currentTarget).data("id")},dataType:"jsonp"}).done(function(a){i.set("bodyContent",b.render(h,{docs:a})),f()})}),$(document).on("click",".J-rollback-version",function(a){if(confirm("确认恢复此版本的代码？\r\n\r\n恢复后，需要重新发布页面，才会更新到线上。")){var b=$(a.currentTarget);$.ajax("/cms/rollback/version",{data:{version_id:$(a.currentTarget).data("version-id")},dataType:"jsonp"}).done(function(a){a&&a.length>0?b.addClass("btn-success").text("成功恢复"):b.addClass("btn-danger").text("恢复失败")})}})})}),define("sjplus/cms/stable/rollback/rollback-source.tpl",[],'<div style="padding: 12px 0">\n    <div style="height: 500px;overflow: auto;">\n        <table class="table table-condensed table-hover table-striped">\n            <tr>\n                <th width="45%">页面名称</th>\n                <th width="22%">日期</th>\n                <th width="15%">用户</th>\n                <th width="15%">操作</th>\n            </tr>\n            #each(item in docs)\n            #run var date=new Date(item.ts)\n            <tr>\n                <td>#{item.page_name}</td>\n                <td>\n                    <a href="/cms/tpl-source/version/#{item._id}" target="_blank" title="查看该版本代码">#{date.getFullYear()}-#{date.getMonth()+1}-#{date.getDate()} #{date.getHours()}:#{date.getMinutes()}:#{date.getSeconds()}</a>\n                </td>\n                <td>#{item.owner_name}</td>\n                <td><a class="btn btn-primary btn-xs J-rollback-version" data-version-id="#{item._id}">恢复</a></td>\n            </tr>\n            #end\n        </table>\n    </div>\n</div>');
